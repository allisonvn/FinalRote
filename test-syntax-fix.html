<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Sintaxe - C√≥digo Corrigido</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .success { background: #d4edda; border-left: 4px solid #28a745; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; }
        
        h1 { color: #333; margin-top: 0; }
        h2 { color: #555; margin-top: 0; }
        
        pre {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 12px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 10px 5px;
            transition: transform 0.2s;
        }
        .btn:hover { transform: translateY(-2px); }
    </style>
</head>
<body>
    <div class="card">
        <h1>üîß Teste de Sintaxe - C√≥digo Corrigido</h1>
        <p>Esta p√°gina testa se o c√≥digo gerado pelo OptimizedCodeGenerator est√° sintaticamente correto.</p>
    </div>

    <div class="card">
        <h2>Teste de Carregamento</h2>
        <button class="btn" onclick="testarCodigo()">
            üß™ Testar C√≥digo Gerado
        </button>
        
        <div id="resultado" style="margin-top: 15px;"></div>
    </div>

    <div class="card">
        <h2>Logs de Debug</h2>
        <div id="logs" style="max-height: 300px; overflow-y: auto; background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const logsDiv = document.getElementById('logs');
            const logEntry = document.createElement('div');
            logEntry.style.marginBottom = '5px';
            logEntry.style.padding = '5px';
            logEntry.style.borderRadius = '4px';
            
            if (type === 'error') {
                logEntry.style.backgroundColor = '#f8d7da';
                logEntry.style.color = '#721c24';
            } else if (type === 'success') {
                logEntry.style.backgroundColor = '#d4edda';
                logEntry.style.color = '#155724';
            } else {
                logEntry.style.backgroundColor = '#d1ecf1';
                logEntry.style.color = '#0c5460';
            }
            
            logEntry.textContent = `[${timestamp}] ${message}`;
            logsDiv.appendChild(logEntry);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function testarCodigo() {
            log('Iniciando teste de sintaxe...', 'info');
            
            try {
                // Simular o c√≥digo que seria gerado pelo OptimizedCodeGenerator
                const experimentId = 'test-syntax-' + Math.random().toString(36).substr(2, 9);
                const baseUrl = 'https://rotafinal.com.br';
                const apiKey = 'pk_test_' + Math.random().toString(36).substr(2, 20);
                const sdkVersion = '3.0.1-auto-conversion';
                const debugMode = false;
                const antiFlickerTimeout = 120;
                const experimentUrls = ['/teste-sintaxe.html'];
                const applyChangesCode = '';
                const conversionTrackingCode = '';
                const setupConversionCode = '';
                const conversionValue = 0;

                // C√≥digo gerado pelo OptimizedCodeGenerator (vers√£o corrigida)
                const codigoGerado = `!function(){"use strict";var e="${experimentId}",t="${baseUrl}",r="${apiKey}",n="${sdkVersion}",o=${debugMode ? 'true' : 'false'},a=${antiFlickerTimeout},i="rf_variant_"+e,s="rf_experiment_"+e,l="rotafinal_exp_"+e,c="rf_queue_"+e,u=18e5,d="rf_redirected_"+e,f="rf_conversion_tracked_"+e,p=${JSON.stringify(experimentUrls)},g=function(e,t){if(o||localStorage.getItem("rf_debug")){try{console.log("[RotaFinal v"+n+"]",e,t||"")}catch(_){}}},h=function(){try{var e="__t";localStorage.setItem(e,"1");localStorage.removeItem(e);return true}catch(_){return false}},m=function(e){try{return localStorage.getItem(e)}catch(_){return null}},v=function(e,t){try{localStorage.setItem(e,t)}catch(_){}},w=function(){if(!p||p.length===0)return true;var e=window.location.pathname;for(var t=0;t<p.length;t++){var r=p[t];if(e===r||e.startsWith(r)||e.includes(r))return true}return false},x=function(){if(!h())return null;try{var e=m(i);if(!e)return null;var t=JSON.parse(e);if(Date.now()-t.t>u)return null;return t.v||null}catch(_){return null}},y=function(){if(!h())return null;try{var e=m(s);if(!e)return null;var t=JSON.parse(e);if(Date.now()-t.t>u)return null;return t.e||null}catch(_){return null}},z=function(e){if(!h())return;v(s,JSON.stringify({e:e,t:Date.now()}))},A=function(e,t){if(!h())return;var r={experimentId:e,experiment_id:e,variantId:t.id,variant_id:t.id,variantName:t.name,variant:t.name,visitorId:B(),visitor_id:B(),timestamp:Date.now()};v(l,JSON.stringify(r));g("üíæ Assignment data saved",r);var n={url:window.location.href,title:document.title,timestamp:Date.now()};v("rotafinal_origin_"+e,JSON.stringify(n));g("üíæ Origin page data saved",n)},C=function(e){if(!e)return false;var t=window.location.href.split("?")[0].split("#")[0],r=e.split("?")[0].split("#")[0];if(r===t)return false;g("‚ö° REDIRECT",e);try{sessionStorage.setItem(d,"1")}catch(_){}window.location.replace(e);return true},B=function(){var e="rf_user_id",t=h()?m(e):null;if(!t){t="rf_"+Math.random().toString(36).slice(2,11)+"_"+Date.now().toString(36);if(h())v(e,t)}return t},D=function(){return{visitor_id:B(),user_agent:navigator.userAgent||"",url:location.href,referrer:document.referrer,timestamp:new Date().toISOString(),viewport:{width:window.innerWidth,height:window.innerHeight}}},E=function(e){if(!e||!e.conversion_url)return;try{if(sessionStorage.getItem(f)==="1"){g("Conversion already tracked");return}}catch(_){}var t=e.conversion_url,r=window.location.pathname,n=window.location.href.split("?")[0].split("#")[0],o="";try{var a=new URL(t,window.location.origin);o=a.pathname}catch(_){o=t.split("?")[0].split("#")[0]}var i=r===o||n.indexOf(o)!==-1||r.indexOf(o)!==-1||n===t||n.indexOf(t)!==-1;if(i){g("üéØ Conversion page detected!",{currentPath:r,conversionPath:o,currentFullUrl:n,conversionUrl:t,value:e.conversion_value});try{sessionStorage.setItem(f,"1")}catch(_){}var c=parseFloat(e.conversion_value)||0;window.RotaFinal.convert(c,{auto:true,url:n,conversion_url:t})}else{g("‚ö†Ô∏è Not on conversion page",{currentPath:r,conversionPath:o,currentFullUrl:n,conversionUrl:t})}};(function(){if(!w())return;try{if(sessionStorage.getItem(d)==="1"){return}}catch(_){}var e=x();if(e){g("üì¶ Using cached variant",e);var t=e.final_url||e.redirect_url;if(t&&!e.is_control){g("‚ö° Cached variant redirect",t);C(t);return}}g("‚ö° First visit - fetching variant");var r=new XMLHttpRequest();r.open("POST",t+"/api/experiments/"+e+"/assign",false);r.setRequestHeader("Content-Type","application/json");r.setRequestHeader("Authorization","Bearer "+r);r.setRequestHeader("X-RF-Version",n);try{r.send(JSON.stringify(D()));if(r.status===200){var a=JSON.parse(r.responseText);if(a.variant){g("‚úÖ Variant received",a.variant);v(i,JSON.stringify({v:a.variant,t:Date.now()}));if(a.experiment){z(a.experiment);A(e,a.variant)}var o=a.variant.final_url||a.variant.redirect_url;if(o&&!a.variant.is_control){g("‚ö° First visit redirect",o);C(o)}}else{g("‚ö†Ô∏è No variant in response",a)}}else{g("‚ö†Ô∏è API returned status",r.status)}}catch(e){g("Sync assign error",e)}}());var F=function(){try{return navigator.userAgent||""}catch(_){return""}},G=function(){return new Date().toISOString()},H=function(e,t,r){r=r||3;var n=new AbortController(),o=setTimeout(function(){n.abort()},5000),a={"Content-Type":"application/json","Authorization":"Bearer "+r,"X-RF-Version":n},i=Object.assign({headers:a,signal:n.signal},t||{});return fetch(e,i).then(function(e){clearTimeout(o);if(!e.ok)throw new Error("HTTP "+e.status);return e.json()}).catch(function(e){clearTimeout(o);if(r<=1)throw e;var t=Math.min(600,100*Math.pow(2,3-r))+Math.random()*120;return new Promise(function(e){setTimeout(e,t)}).then(function(){return H(e,t,r-1)})})},I=function(){var e=F().toLowerCase();return/bot|crawler|spider|crawling|archiver|scraper|slurp|wget|curl|httpunit|preview|prerender|headless/i.test(e)},J=function(e){if(!h())return;v(i,JSON.stringify({v:e,t:Date.now()}))},K={cachedVariant:null,applyVariant:function(e){if(!e)return;this.cachedVariant=e;document.documentElement.setAttribute("data-rf-experiment",e);document.documentElement.setAttribute("data-rf-variant",e.name||"control");document.documentElement.setAttribute("data-rf-user",B());${applyChangesCode}}},L=null,M=function(){if(K.cachedVariant)return Promise.resolve({variant:K.cachedVariant});if(L)return L;var e=x();if(e){K.cachedVariant=e;return Promise.resolve({variant:e})}try{if(sessionStorage.getItem(d)==="1"){return Promise.resolve({variant:{name:"redirected",skip:true}})}}catch(_){}L=H(t+"/api/experiments/"+e+"/assign",{method:"POST",body:JSON.stringify(D())}).then(function(e){if(e&&e.variant){K.cachedVariant=e.variant;J(e.variant);if(e.experiment){z(e.experiment);A(experimentId,e.variant)}}return e}).catch(function(e){g("Assign error",e);return{variant:{name:"control",is_control:true,error:true}}}).finally(function(){L=null});return L},N={eventQueue:[],_clickBuffer:[],_clickTimer:null,baseEvent:function(e,t){return{experiment_id:experimentId,visitor_id:B(),variant_id:K.cachedVariant&&K.cachedVariant.id||null,variant:K.cachedVariant&&K.cachedVariant.name||null,event_type:e,properties:t||{},timestamp:G(),url:location.href,referrer:document.referrer,user_agent:F()}},track:function(e,t){var r=this.baseEvent(e,t);g("Track",e,r);return H(t+"/api/track",{method:"POST",body:JSON.stringify(r)}).catch(function(e){N.enqueue(r)})},trackBufferedClick:function(e,t){this._clickBuffer.push(this.baseEvent(e,t));if(this._clickTimer)return;this._clickTimer=setTimeout(function(){N._clickTimer=null;N.flushClicks()},150)},flushClicks:function(){var e=N._clickBuffer.splice(0);if(!e.length)return;H(t+"/api/track/batch",{method:"POST",body:JSON.stringify({events:e})}).catch(function(){N.eventQueue.push.apply(N.eventQueue,e);O()})},setupClickTracking:function(){document.addEventListener("click",function(e){var t=e.target&&e.target.closest&&e.target.closest("[data-rf-track]");if(!t)return;var r=t.getAttribute("data-rf-track")||"click",n={};Array.prototype.forEach.call(t.attributes,function(e){if(e.name.indexOf("data-rf-")===0&&e.name!=="data-rf-track"){n[e.name.replace("data-rf-","")]=e.value}});var o={element:t.tagName.toLowerCase(),text:(t.textContent||"").trim().slice(0,100)};Object.assign(o,n);N.trackBufferedClick(r,o)},true)},trackPageview:function(){this.track("page_view",{title:document.title,path:location.pathname,search:location.search})},enqueue:function(e){N.eventQueue.push(e);O()},flushQueue:function(){if(!N.eventQueue.length)return;var e=N.eventQueue.splice(0);O();H(t+"/api/track/batch",{method:"POST",body:JSON.stringify({events:e})}).catch(function(){N.eventQueue.unshift.apply(N.eventQueue,e);O()})}${conversionTrackingCode}},O=function(){if(!h())return;try{v(c,JSON.stringify(N.eventQueue))}catch(_){}},P=function(){if(!h())return[];try{return JSON.parse(m(c)||"[]")}catch(_){return[]}};N.eventQueue=P();var Q=N.eventQueue.push.bind(N.eventQueue);N.eventQueue.push=function(){var e=Q.apply(N.eventQueue,arguments);O();return e};function R(){if(!N.eventQueue.length)return;var e=JSON.stringify({events:N.eventQueue});if(navigator.sendBeacon){var t=navigator.sendBeacon(t+"/api/track/batch",new Blob([e],{type:"application/json"}));if(t){N.eventQueue=[];O();return}}N.flushQueue()}document.addEventListener("visibilitychange",function(){if(document.visibilityState==="hidden")R()});window.addEventListener("beforeunload",R);function S(){document.body.setAttribute("data-rf-ready","true");var e=document.querySelector("style[data-rf-antiflicker]");if(e)setTimeout(function(){try{e.remove()}catch(_){}},80);g("Page visible")}function T(e){return window.requestIdleCallback?requestIdleCallback(e,{timeout:500}):setTimeout(e,50)}function U(){if(!w()){S();return}if(I()){S();return}g("Init");var e=setTimeout(S,a);M().then(function(t){clearTimeout(e);if(t&&t.variant&&!t.variant.skip){K.cachedVariant=t.variant;if(t.experiment){z(t.experiment);A(experimentId,t.variant);E(t.experiment)}K.applyVariant(t.variant);N.trackPageview();${setupConversionCode}S()}else{S()}}).catch(function(e){clearTimeout(e);S()});T(function(){N.setupClickTracking();var e=y();if(e){E(e)}})}window.RotaFinal={track:function(e,t){return N.track(e,t)},convert:function(e,t){return N.track("conversion",Object.assign({value:e||${conversionValue}},t))},getVariant:function(){return K.cachedVariant},getUserId:B,reload:function(){K.cachedVariant=null;v(i,"");v(s,"");v(l,"");try{sessionStorage.removeItem(d);sessionStorage.removeItem(f)}catch(_){}location.reload()},setDebug:function(e){e?localStorage.setItem("rf_debug","1"):localStorage.removeItem("rf_debug");o=e;location.reload()}};if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",U)}else{U()}}();`;

                log('C√≥digo gerado com sucesso', 'success');
                
                // Testar se o c√≥digo √© v√°lido JavaScript
                try {
                    // Criar uma fun√ß√£o tempor√°ria para testar a sintaxe
                    const testFunction = new Function(codigoGerado);
                    log('‚úÖ Sintaxe JavaScript v√°lida!', 'success');
                    
                    // Testar se o c√≥digo executa sem erros
                    eval(codigoGerado);
                    log('‚úÖ C√≥digo executado sem erros!', 'success');
                    
                    // Verificar se o objeto RotaFinal foi criado
                    if (typeof window.RotaFinal === 'object' && window.RotaFinal !== null) {
                        log('‚úÖ Objeto RotaFinal criado com sucesso!', 'success');
                        log(`M√©todos dispon√≠veis: ${Object.keys(window.RotaFinal).join(', ')}`, 'info');
                    } else {
                        log('‚ùå Objeto RotaFinal n√£o foi criado', 'error');
                    }
                    
                    document.getElementById('resultado').innerHTML = `
                        <div class="card success">
                            <strong>‚úÖ SUCESSO!</strong>
                            <p>O c√≥digo gerado est√° sintaticamente correto e executa sem erros.</p>
                            <p><strong>Experimento ID:</strong> ${experimentId}</p>
                            <p><strong>Vers√£o SDK:</strong> ${sdkVersion}</p>
                            <p><strong>RotaFinal dispon√≠vel:</strong> ${typeof window.RotaFinal === 'object' ? 'Sim' : 'N√£o'}</p>
                        </div>
                    `;
                    
                } catch (syntaxError) {
                    log(`‚ùå Erro de sintaxe: ${syntaxError.message}`, 'error');
                    log(`Linha: ${syntaxError.lineNumber || 'N/A'}`, 'error');
                    log(`Coluna: ${syntaxError.columnNumber || 'N/A'}`, 'error');
                    
                    document.getElementById('resultado').innerHTML = `
                        <div class="card error">
                            <strong>‚ùå ERRO DE SINTAXE!</strong>
                            <p><strong>Erro:</strong> ${syntaxError.message}</p>
                            <p><strong>Linha:</strong> ${syntaxError.lineNumber || 'N/A'}</p>
                            <p><strong>Coluna:</strong> ${syntaxError.columnNumber || 'N/A'}</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                log(`‚ùå Erro geral: ${error.message}`, 'error');
                document.getElementById('resultado').innerHTML = `
                    <div class="card error">
                        <strong>‚ùå ERRO GERAL!</strong>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Inicializar
        log('P√°gina de teste carregada', 'info');
        log('Clique em "Testar C√≥digo Gerado" para verificar a sintaxe', 'info');
    </script>
</body>
</html>
